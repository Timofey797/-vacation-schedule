<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚òÅÔ∏è –ì—Ä–∞—Ñ–∏–∫ –æ—Ç–ø—É—Å–∫–æ–≤ - –û–±–ª–∞—á–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: none; width: 100%; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; }
        .controls { display: flex; justify-content: center; gap: 15px; padding: 25px; background: #f8f9fa; border-bottom: 2px solid #e9ecef; flex-wrap: wrap; }
        .view-controls { display: flex; justify-content: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #dee2e6; }
        .view-toggle { display: flex; background: white; border-radius: 25px; padding: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .view-btn { padding: 10px 20px; border: none; border-radius: 20px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; background: transparent; color: #6c757d; }
        .view-btn.active { background: linear-gradient(135deg, #007bff, #0056b3); color: white; box-shadow: 0 2px 8px rgba(0,123,255,0.3); }
        .view-btn:hover:not(.active) { background: #f8f9fa; color: #495057; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-vacation { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; }
        .btn-business { background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; }
        .btn-sick { background: linear-gradient(135deg, #a8e6cf, #88d8a3); color: white; }
        .btn-delete { background: linear-gradient(135deg, #dc3545, #c82333); color: white; }
        .btn-export { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .main-content { padding: 30px; overflow-x: auto; }
        .legend { margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-color { width: 20px; height: 20px; border-radius: 4px; }
        .vacation-color { background: linear-gradient(45deg, #ff6b6b, #ff8e8e); }
        .business-color { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
        .sick-color { background: linear-gradient(45deg, #a8e6cf, #88d8a3); }
        .gantt-container { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-x: auto; min-width: 2000px; width: 100%; }
        .timeline-header { display: grid; grid-template-columns: 300px 1fr; margin-bottom: 20px; font-weight: bold; color: #2c3e50; }
        .days-row { display: grid; grid-template-columns: repeat(31, minmax(40px, 1fr)); gap: 1px; text-align: center; }
        .months-row { display: grid; grid-template-columns: repeat(12, minmax(120px, 1fr)); gap: 3px; text-align: center; }
        .day-header, .month-header { background: #e9ecef; padding: 8px 4px; border-radius: 3px; font-size: 11px; font-weight: bold; border: 1px solid #dee2e6; }
        .day-header.weekend { background: #ffebee; color: #c62828; }
        .day-header.today { background: #e3f2fd; color: #1976d2; font-weight: bold; }
        .employee-row { display: grid; grid-template-columns: 300px 1fr; align-items: center; margin-bottom: 15px; padding: 12px; background: #f8f9fa; border-radius: 8px; transition: all 0.3s ease; }
        .employee-row:hover { background: #e9ecef; transform: translateX(3px); }
        .employee-name { font-weight: bold; color: #2c3e50; padding-right: 20px; font-size: 15px; }
        .timeline { position: relative; height: 50px; background: #e9ecef; border-radius: 8px; display: grid; gap: 1px; overflow: visible; }
        .timeline.days-view { grid-template-columns: repeat(31, minmax(40px, 1fr)); }
        .timeline.months-view { grid-template-columns: repeat(12, minmax(120px, 1fr)); }
        .day-section, .month-section { position: relative; background: #f8f9fa; border-radius: 2px; border: 1px solid #dee2e6; }
        .day-section.weekend { background: #fff3e0; }
        .day-section.today { background: #e8f5e8; border-color: #4caf50; }
        .absence-bar { position: absolute; height: 35px; top: 7.5px; border-radius: 5px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); min-width: 40px; }
        .absence-bar:hover { transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 30; }
        .absence-bar .delete-btn { position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer; display: none; z-index: 40; }
        .absence-bar:hover .delete-btn { display: block; }
        .vacation-bar { background: linear-gradient(45deg, #ff6b6b, #ff8e8e); }
        .business-bar { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
        .sick-bar { background: linear-gradient(45deg, #a8e6cf, #88d8a3); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 5% auto; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1; }
        .close:hover { color: #000; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 3px rgba(0,123,255,0.1); }
        .form-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px; }
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #6c757d, #495057); color: white; }
        .btn-sync { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .btn-sync:hover { background: linear-gradient(135deg, #20c997, #17a2b8); }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .upcoming-absences { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; padding: 20px; margin-bottom: 25px; }
        .upcoming-absences h3 { color: #856404; margin-bottom: 15px; }
        .upcoming-list { display: grid; gap: 10px; }
        .upcoming-item { background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #ff6b6b; }
        .upcoming-item.business { border-left-color: #4ecdc4; }
        .upcoming-item.sick { border-left-color: #a8e6cf; }
        .edit-only { display: none; }
        .error-message { color: #dc3545; font-size: 12px; margin-top: 5px; display: none; }
        .save-notification { position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 10px 20px; border-radius: 5px; z-index: 10000; font-size: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        @media (max-width: 768px) { .gantt-container { padding: 15px; } .timeline-header, .employee-row { grid-template-columns: 200px 1fr; } .employee-name { font-size: 12px; padding-right: 10px; } .days-row, .timeline.days-view { grid-template-columns: repeat(31, minmax(30px, 1fr)); } .months-row, .timeline.months-view { grid-template-columns: repeat(12, minmax(80px, 1fr)); } .day-header { font-size: 9px; padding: 6px 2px; } .month-header { font-size: 10px; padding: 8px 4px; } .controls { padding: 15px; gap: 10px; } .btn { padding: 10px 15px; font-size: 12px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚òÅÔ∏è –ì—Ä–∞—Ñ–∏–∫ –æ—Ç–ø—É—Å–∫–æ–≤ - –û–±–ª–∞—á–Ω–∞—è –≤–µ—Ä—Å–∏—è</h1>
            <p>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="controls">
            <button class="btn btn-sync" onclick="authenticateWithGoogle()">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google</button>
            <button class="btn btn-sync" onclick="syncWithSheets()">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-vacation" onclick="showModal('vacation')">üèñÔ∏è –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—É—Å–∫</button>
            <button class="btn btn-business" onclick="showModal('business')">‚úàÔ∏è –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫—É</button>
            <button class="btn btn-sick" onclick="showModal('sick')">üè• –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å–Ω–∏—á–Ω—ã–π</button>
            <button class="btn btn-delete" onclick="showDeleteModal()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ</button>
            <button class="btn btn-export" onclick="exportData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="btn btn-export" onclick="importData()">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="btn btn-delete" onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <button class="btn btn-primary" onclick="showAddEmployeeModal()">üë• –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
        </div>

        <div class="sync-status" id="sync-status" style="text-align: center; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; margin: 10px 0; border-radius: 5px;">
            üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...
        </div>

        <div class="view-controls">
            <div class="view-toggle">
                <button class="view-btn active" onclick="switchView('days')" id="days-view-btn">üìÖ –ü–æ –¥–Ω—è–º</button>
                <button class="view-btn" onclick="switchView('months')" id="months-view-btn">üìä –ü–æ –º–µ—Å—è—Ü–∞–º</button>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∂–∏–º–∞ "–ü–æ –¥–Ω—è–º") -->
        <div class="main-content">
            

            <div class="upcoming-absences">
                <h3>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è</h3>
                <div id="upcoming-list" class="upcoming-list"></div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∂–∏–º–∞ "–ü–æ –¥–Ω—è–º") - —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –º–µ–∂–¥—É –±–ª–æ–∫–æ–º –±–ª–∏–∂–∞–π—à–∏—Ö –∏ –ª–µ–≥–µ–Ω–¥–æ–π -->
            <div id="month-navigation" style="display: none; text-align: center; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; margin: 15px 0;">
                <button onclick="changeMonth(-1)" style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-right: 10px; cursor: pointer;">‚Üê</button>
                <span id="current-month-display" style="font-weight: bold; font-size: 16px; margin: 0 20px;">–°–µ–Ω—Ç—è–±—Ä—å 2025</span>
                <button onclick="changeMonth(1)" style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-left: 10px; cursor: pointer;">‚Üí</button>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color vacation-color"></div>
                    <span>–û—Ç–ø—É—Å–∫–∞</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color business-color"></div>
                    <span>–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∏</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color sick-color"></div>
                    <span>–ë–æ–ª—å–Ω–∏—á–Ω—ã–µ</span>
                </div>
            </div>

            <div class="gantt-container">
                <div class="timeline-header">
                    <div>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</div>
                    <div class="days-row" id="timeline-header"></div>
                </div>

                <div id="employees-container">
                    <!-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ</h2>
            
            <form id="absence-form">
                <div class="form-group">
                    <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label>
                    <select id="employee" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>
                        <option value="–ì–ª—É—à–∫–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä">–ì–ª—É—à–∫–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä</option>
                        <option value="–õ–∏—Ö—Ç–µ–Ω–≤–∞–ª—å–¥ –≠–¥—É–∞—Ä–¥">–õ–∏—Ö—Ç–µ–Ω–≤–∞–ª—å–¥ –≠–¥—É–∞—Ä–¥</option>
                        <option value="–®–∞–π—Ö—É—Ç–¥–∏–Ω–æ–≤ –†–∏–Ω–∞—Ç">–®–∞–π—Ö—É—Ç–¥–∏–Ω–æ–≤ –†–∏–Ω–∞—Ç</option>
                        <option value="–í–∞—Ä–∂–∏–Ω—Å–∫–∏–π –ü–∞–≤–µ–ª">–í–∞—Ä–∂–∏–Ω—Å–∫–∏–π –ü–∞–≤–µ–ª</option>
                    </select>
                </div>

                <div class="form-group edit-only" id="type-select-group">
                    <label>–¢–∏–ø –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è:</label>
                    <select id="absence-type">
                        <option value="vacation">–û—Ç–ø—É—Å–∫</option>
                        <option value="business">–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞</option>
                        <option value="sick">–ë–æ–ª—å–Ω–∏—á–Ω—ã–π</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                    <input type="date" id="start-date" required min="2025-01-01" max="2025-12-31">
                    <div class="error-message" id="start-date-error"></div>
                </div>

                <div class="form-group">
                    <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                    <input type="date" id="end-date" required min="2025-01-01" max="2025-12-31">
                    <div class="error-message" id="end-date-error"></div>
                </div>

                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                    <input type="text" id="comment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">
                </div>

                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h2>üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ</h2>
            
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:</label>
                <select id="delete-absence-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ...</option>
                </select>
            </div>

            <div class="form-buttons">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-delete" onclick="deleteAbsence()">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
    <div id="add-employee-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddEmployeeModal()">&times;</span>
            <h2>üë• –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
            
            <form id="add-employee-form">
                <div class="form-group">
                    <label>–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
                    <input type="text" id="new-employee-name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞">
                    <div class="error-message" id="employee-name-error"></div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeAddEmployeeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentAbsenceType = '';
        let absences = [];
        let editingId = null;
        let currentView = 'days';
        let currentMonth = 9;
        let employees = ['–ì–ª—É—à–∫–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–õ–∏—Ö—Ç–µ–Ω–≤–∞–ª—å–¥ –≠–¥—É–∞—Ä–¥', '–®–∞–π—Ö—É—Ç–¥–∏–Ω–æ–≤ –†–∏–Ω–∞—Ç', '–í–∞—Ä–∂–∏–Ω—Å–∫–∏–π –ü–∞–≤–µ–ª'];

        // –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            localStorage.setItem('vacationScheduleData', JSON.stringify(absences));
            showSaveNotification();
            
            // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets, –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
            if (gapiInitialized && gapi.client.getToken()) {
                saveDataToSheets();
            }
        }

        function loadData() {
            const savedData = localStorage.getItem('vacationScheduleData');
            if (savedData) {
                try {
                    absences = JSON.parse(savedData);
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
                    return false;
                }
            }
            return false;
        }

        function showSaveNotification() {
            const notification = document.createElement('div');
            notification.className = 'save-notification';
            notification.textContent = 'üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        function exportData() {
            const dataStr = JSON.stringify(absences, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'vacation_schedule_data.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
                        if (!Array.isArray(importedData)) {
                            alert('–û—à–∏–±–∫–∞: –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö');
                            return;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                        const isValid = importedData.every(item => 
                            item.employee && item.startDate && item.endDate && item.type
                        );
                        
                        if (!isValid) {
                            alert('–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ');
                            return;
                        }
                        
                        if (confirm(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${importedData.length} –∑–∞–ø–∏—Å–µ–π? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.`)) {
                            absences = importedData;
                            renderAbsences();
                            updateStats();
                            updateUpcomingAbsences();
                            saveData();
                            alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                        }
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                if (confirm('–≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                    absences = [];
                    renderAbsences();
                    updateStats();
                    updateUpcomingAbsences();
                    saveData();
                    alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã!');
                }
            }
        }

        function showAddEmployeeModal() {
            document.getElementById('add-employee-modal').style.display = 'block';
            document.getElementById('new-employee-name').value = '';
            hideErrors();
        }

        function closeAddEmployeeModal() {
            document.getElementById('add-employee-modal').style.display = 'none';
            hideErrors();
        }

        function addEmployee() {
            const name = document.getElementById('new-employee-name').value.trim();
            
            if (!name) {
                showError('employee-name-error', '–í–≤–µ–¥–∏—Ç–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
                return;
            }
            
            if (employees.includes(name)) {
                showError('employee-name-error', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            employees.push(name);
            updateEmployeeSelects();
            updateEmployeesContainer();
            closeAddEmployeeModal();
            alert(`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!`);
        }

        function updateEmployeeSelects() {
            const selects = document.querySelectorAll('#employee, #delete-absence-select');
            selects.forEach(select => {
                if (select.id === 'employee') {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>';
                    employees.forEach(employee => {
                        const option = document.createElement('option');
                        option.value = employee;
                        option.textContent = employee;
                        if (employee === currentValue) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });
                }
            });
        }

        function updateEmployeesContainer() {
            const container = document.getElementById('employees-container');
            container.innerHTML = '';
            
            employees.forEach(employee => {
                const row = document.createElement('div');
                row.className = 'employee-row';
                row.innerHTML = `
                    <div class="employee-name">${employee}</div>
                    <div class="timeline ${currentView}-view" data-employee="${employee}"></div>
                `;
                container.appendChild(row);
            });
            
            updateTimelines();
            renderAbsences();
        }

        function switchView(view) {
            currentView = view;
            document.getElementById('days-view-btn').classList.toggle('active', view === 'days');
            document.getElementById('months-view-btn').classList.toggle('active', view === 'months');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –º–µ—Å—è—Ü–∞–º
            const monthNav = document.getElementById('month-navigation');
            if (monthNav) {
                monthNav.style.display = view === 'days' ? 'block' : 'none';
                if (view === 'days') {
                    updateMonthNavigation();
                }
            }
            
            updateTimelineHeader();
            updateTimelines();
            renderAbsences();
        }

        function updateTimelineHeader() {
            const header = document.getElementById('timeline-header');
            header.innerHTML = '';
            
            if (currentView === 'days') {
                header.className = 'days-row';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
                const daysInMonth = new Date(2025, currentMonth, 0).getDate();
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'day-header';
                    dayElement.textContent = day;
                    
                    const date = new Date(2025, currentMonth - 1, day);
                    const dayOfWeek = date.getDay();
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        dayElement.classList.add('weekend');
                    }
                    
                    const today = new Date();
                    if (today.getDate() === day && today.getMonth() === currentMonth - 1 && today.getFullYear() === 2025) {
                        dayElement.classList.add('today');
                    }
                    
                    header.appendChild(dayElement);
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è grid
                header.style.gridTemplateColumns = `repeat(${daysInMonth}, minmax(40px, 1fr))`;
            } else {
                header.className = 'months-row';
                const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                              '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
                
                months.forEach(month => {
                    const monthElement = document.createElement('div');
                    monthElement.className = 'month-header';
                    monthElement.textContent = month;
                    header.appendChild(monthElement);
                });
                // 12 —Ä–∞–≤–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω–æ–π, —á—Ç–æ–±—ã –º–µ—Å—è—Ü—ã –Ω–µ —Å–∂–∏–º–∞–ª–∏—Å—å
                header.style.gridTemplateColumns = 'repeat(12, minmax(100px, 1fr))';
            }
        }

        function updateTimelines() {
            employees.forEach(employee => {
                const timeline = document.querySelector(`[data-employee="${employee}"]`);
                timeline.innerHTML = '';
                timeline.className = `timeline ${currentView}-view`;
                
                if (currentView === 'days') {
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
                    const daysInMonth = new Date(2025, currentMonth, 0).getDate();
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayElement = document.createElement('div');
                        dayElement.className = 'day-section';
                        dayElement.setAttribute('data-day', day);
                        
                        const date = new Date(2025, currentMonth - 1, day);
                        const dayOfWeek = date.getDay();
                        if (dayOfWeek === 0 || dayOfWeek === 6) {
                            dayElement.classList.add('weekend');
                        }
                        
                        const today = new Date();
                        if (today.getDate() === day && today.getMonth() === currentMonth - 1 && today.getFullYear() === 2025) {
                            dayElement.classList.add('today');
                        }
                        
                        timeline.appendChild(dayElement);
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è grid
                    timeline.style.gridTemplateColumns = `repeat(${daysInMonth}, minmax(40px, 1fr))`;
                } else {
                    for (let month = 1; month <= 12; month++) {
                        const monthElement = document.createElement('div');
                        monthElement.className = 'month-section';
                        monthElement.setAttribute('data-month', month);
                        timeline.appendChild(monthElement);
                    }
                    // 12 —Ä–∞–≤–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –≥–æ–¥–æ–≤–æ–≥–æ –≤–∏–¥–∞
                    timeline.style.gridTemplateColumns = 'repeat(12, minmax(100px, 1fr))';
                }
            });
        }

        function showModal(type) {
            currentAbsenceType = type;
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const typeSelectGroup = document.getElementById('type-select-group');
            
            const titles = {
                vacation: 'üèñÔ∏è –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—É—Å–∫',
                business: '‚úàÔ∏è –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫—É',
                sick: 'üè• –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å–Ω–∏—á–Ω—ã–π'
            };
            
            title.textContent = titles[type];
            typeSelectGroup.style.display = 'none';
            modal.style.display = 'block';
            
            document.getElementById('absence-form').reset();
            editingId = null;
            hideErrors();
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            hideErrors();
        }

        function showDeleteModal() {
            const modal = document.getElementById('delete-modal');
            const select = document.getElementById('delete-absence-select');
            
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ...</option>';
            
            absences.forEach(absence => {
                const option = document.createElement('option');
                option.value = absence.id;
                option.textContent = `${absence.employee} - ${getTypeName(absence.type)} (${absence.startDate} - ${absence.endDate})`;
                select.appendChild(option);
            });
            
            modal.style.display = 'block';
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').style.display = 'none';
        }

        function deleteAbsence() {
            const select = document.getElementById('delete-absence-select');
            const absenceId = parseInt(select.value);
            
            if (!absenceId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!');
                return;
            }
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ?')) {
                absences = absences.filter(a => a.id !== absenceId);
                renderAbsences();
                updateStats();
                updateUpcomingAbsences();
                saveData();
                closeDeleteModal();
            }
        }

        function getTypeName(type) {
            const names = {
                vacation: '–û—Ç–ø—É—Å–∫',
                business: '–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞',
                sick: '–ë–æ–ª—å–Ω–∏—á–Ω—ã–π'
            };
            return names[type] || type;
        }

        function hideErrors() {
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        document.getElementById('add-employee-form').addEventListener('submit', function(e) {
            e.preventDefault();
            addEmployee();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
        document.getElementById('absence-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const employee = document.getElementById('employee').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const comment = document.getElementById('comment').value;
            
            let absenceType = currentAbsenceType;
            if (editingId) {
                absenceType = document.getElementById('absence-type').value;
            }

            hideErrors();
            let hasErrors = false;

            if (!employee) {
                showError('employee-error', '–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
                hasErrors = true;
            }

            if (!startDate) {
                showError('start-date-error', '–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞');
                hasErrors = true;
            }

            if (!endDate) {
                showError('end-date-error', '–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                hasErrors = true;
            }

            if (startDate && endDate && new Date(startDate) > new Date(endDate)) {
                showError('end-date-error', '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                hasErrors = true;
            }

            if (startDate && new Date(startDate).getFullYear() !== 2025) {
                showError('start-date-error', '–î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ 2025 –≥–æ–¥—É');
                hasErrors = true;
            }

            if (endDate && new Date(endDate).getFullYear() !== 2025) {
                showError('end-date-error', '–î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ 2025 –≥–æ–¥—É');
                hasErrors = true;
            }

            if (hasErrors) {
                return;
            }

            const absence = {
                id: editingId || Date.now(),
                employee,
                startDate,
                endDate,
                type: absenceType,
                comment
            };

            if (editingId) {
                const index = absences.findIndex(a => a.id === editingId);
                absences[index] = absence;
            } else {
                absences.push(absence);
            }

            renderAbsences();
            updateStats();
            updateUpcomingAbsences();
            saveData();
            closeModal();
        });

        function renderAbsences() {
            document.querySelectorAll('.absence-bar').forEach(bar => bar.remove());

            const monthStart = new Date(2025, currentMonth - 1, 1);
            const monthEnd = new Date(2025, currentMonth, 0);

            absences.forEach(absence => {
                const timeline = document.querySelector(`[data-employee="${absence.employee}"]`);
                if (!timeline) return;

                // –í —Ä–µ–∂–∏–º–µ –ø–æ –¥–Ω—è–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å —Ç–µ–∫—É—â–∏–º –º–µ—Å—è—Ü–µ–º
                if (currentView === 'days') {
                    const start = new Date(absence.startDate);
                    const end = new Date(absence.endDate);
                    const intersects = !(end < monthStart || start > monthEnd);
                    if (!intersects) return;
                }

                const bar = createAbsenceBar(absence);
                timeline.appendChild(bar);
            });
        }

        function createAbsenceBar(absence) {
            const bar = document.createElement('div');
            bar.className = `absence-bar ${absence.type}-bar`;
            bar.setAttribute('data-id', absence.id);
            
            const position = calculatePosition(absence.startDate, absence.endDate);
            bar.style.left = position.left;
            bar.style.width = position.width;
            
            const startDate = new Date(absence.startDate);
            const endDate = new Date(absence.endDate);
            
            if (currentView === 'days') {
                const startDay = startDate.getDate();
                const endDay = endDate.getDate();
                const month = startDate.getMonth() + 1;
                bar.textContent = `${startDay}-${endDay}.${month < 10 ? '0' + month : month}`;
            } else {
                const startMonth = startDate.getMonth() + 1;
                const endMonth = endDate.getMonth() + 1;
                bar.textContent = `${startMonth}.${endMonth}`;
            }
            
            const typeNames = {
                vacation: '–û—Ç–ø—É—Å–∫',
                business: '–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞',
                sick: '–ë–æ–ª—å–Ω–∏—á–Ω—ã–π'
            };
            
            bar.title = `${typeNames[absence.type]}: ${absence.startDate} - ${absence.endDate}${absence.comment ? '\n' + absence.comment : ''}`;
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '√ó';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                if (confirm(`–£–¥–∞–ª–∏—Ç—å ${typeNames[absence.type].toLowerCase()} –¥–ª—è ${absence.employee}?`)) {
                    absences = absences.filter(a => a.id !== absence.id);
                    renderAbsences();
                    updateStats();
                    updateUpcomingAbsences();
                    saveData();
                }
            };
            bar.appendChild(deleteBtn);
            
            bar.onclick = () => editAbsence(absence.id);
            
            return bar;
        }

        function calculatePosition(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (currentView === 'days') {
                const monthStart = new Date(2025, currentMonth - 1, 1);
                const monthEnd = new Date(2025, currentMonth, 0);
                const daysInMonth = monthEnd.getDate();

                // –û–±—Ä–µ–∑–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
                const displayStart = start < monthStart ? monthStart : start;
                const displayEnd = end > monthEnd ? monthEnd : end;

                const startDay = displayStart.getDate();
                const endDay = displayEnd.getDate();

                const dayWidth = 100 / daysInMonth;
                const leftPercent = (startDay - 1) * dayWidth;
                const widthPercent = (endDay - startDay + 1) * dayWidth;

                return {
                    left: `${Math.max(0, leftPercent)}%`,
                    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 3% —á—Ç–æ–±—ã –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç—Ä–µ–∑–∫–∏ –±—ã–ª–∏ –≤–∏–¥–∏–º—ã
                    width: `${Math.max(3, Math.min(100 - leftPercent, widthPercent))}%`
                };
            } else {
                // –ì–æ–¥–æ–≤–æ–π —Ä–µ–∂–∏–º: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é c —É—á—ë—Ç–æ–º –¥–æ–ª–µ–π –º–µ—Å—è—Ü–µ–≤
                const startMonth = start.getMonth();
                const endMonth = end.getMonth();
                const startDay = start.getDate();
                const endDay = end.getDate();
                const monthWidth = 100 / 12;

                let leftPercent = 0;
                let widthPercent = 0;

                if (startMonth === endMonth) {
                    const daysInMonth = new Date(start.getFullYear(), startMonth + 1, 0).getDate();
                    const startFrac = (startDay - 1) / daysInMonth;
                    const endFrac = endDay / daysInMonth;
                    leftPercent = startMonth * monthWidth + startFrac * monthWidth;
                    widthPercent = Math.max(0, (endFrac - startFrac) * monthWidth);
                } else {
                    const startDaysInMonth = new Date(start.getFullYear(), startMonth + 1, 0).getDate();
                    const endDaysInMonth = new Date(end.getFullYear(), endMonth + 1, 0).getDate();
                    const startFrac = (startDay - 1) / startDaysInMonth;
                    const endFrac = endDay / endDaysInMonth;

                    leftPercent = startMonth * monthWidth + startFrac * monthWidth;

                    const fullMonthsBetween = Math.max(0, endMonth - startMonth - 1);
                    widthPercent = (1 - startFrac) * monthWidth + fullMonthsBetween * monthWidth + endFrac * monthWidth;
                }

                return {
                    left: `${Math.max(0, leftPercent)}%`,
                    width: `${Math.max(2, Math.min(100 - leftPercent, widthPercent))}%`
                };
            }
        }

        function editAbsence(id) {
            const absence = absences.find(a => a.id === id);
            if (!absence) return;

            editingId = id;
            currentAbsenceType = absence.type;
            
            const typeSelectGroup = document.getElementById('type-select-group');
            const absenceTypeSelect = document.getElementById('absence-type');
            
            document.getElementById('employee').value = absence.employee;
            document.getElementById('start-date').value = absence.startDate;
            document.getElementById('end-date').value = absence.endDate;
            document.getElementById('comment').value = absence.comment || '';
            
            typeSelectGroup.style.display = 'block';
            absenceTypeSelect.value = absence.type;
            
            document.getElementById('modal-title').textContent = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ';
            document.getElementById('modal').style.display = 'block';
        }

        function updateStats() {
            const totalAbsences = absences.length;
            const currentDate = new Date();
            const currentAbsences = absences.filter(absence => {
                const start = new Date(absence.startDate);
                const end = new Date(absence.endDate);
                return currentDate >= start && currentDate <= end;
            }).length;

            const upcomingAbsences = absences.filter(absence => {
                const start = new Date(absence.startDate);
                const futureDate = new Date();
                futureDate.setDate(futureDate.getDate() + 30);
                return start > currentDate && start <= futureDate;
            }).length;

            const totalEl = document.getElementById('total-absences');
            const currentEl = document.getElementById('current-absences');
            const upcomingEl = document.getElementById('upcoming-absences');

            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É–¥–∞–ª–µ–Ω—ã ‚Äî —Ç–∏—Ö–æ –≤—ã—Ö–æ–¥–∏–º
            if (!totalEl || !currentEl || !upcomingEl) return;

            totalEl.textContent = totalAbsences;
            currentEl.textContent = currentAbsences;
            upcomingEl.textContent = upcomingAbsences;
        }

        function updateUpcomingAbsences() {
            const container = document.getElementById('upcoming-list');
            container.innerHTML = '';
            
            const currentDate = new Date();
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 30);
            
            const upcoming = absences.filter(absence => {
                const start = new Date(absence.startDate);
                return start > currentDate && start <= futureDate;
            }).sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            upcoming.forEach(absence => {
                const item = document.createElement('div');
                item.className = `upcoming-item ${absence.type}`;
                item.innerHTML = `
                    <strong>${absence.employee}</strong> - ${getTypeName(absence.type)}<br>
                    <small>${absence.startDate} - ${absence.endDate}</small>
                    ${absence.comment ? `<br><small>üí¨ ${absence.comment}</small>` : ''}
                `;
                container.appendChild(item);
            });
            
            if (upcoming.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–π</p>';
            }
        }

        function addDemoData() {
            const demoAbsences = [
                {
                    id: 1,
                    employee: '–ì–ª—É—à–∫–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä',
                    startDate: '2025-09-08',
                    endDate: '2025-09-26',
                    type: 'vacation',
                    comment: '–û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–ø—É—Å–∫'
                },
                {
                    id: 2,
                    employee: '–®–∞–π—Ö—É—Ç–¥–∏–Ω–æ–≤ –†–∏–Ω–∞—Ç',
                    startDate: '2025-09-08',
                    endDate: '2025-09-19',
                    type: 'vacation',
                    comment: '–û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–ø—É—Å–∫'
                }
            ];
            
            absences = demoAbsences;
            renderAbsences();
            updateStats();
            updateUpcomingAbsences();
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            const deleteModal = document.getElementById('delete-modal');
            const addEmployeeModal = document.getElementById('add-employee-modal');
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
            if (event.target === addEmployeeModal) {
                closeAddEmployeeModal();
            }
        }

        // Google Sheets –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const GOOGLE_SHEETS_CONFIG = {
            spreadsheetId: '1RIHLTF5UnmfHxBGLC1pM5q7xJ0EfhLe_85wV6lPXnwY',
            range: '–ì—Ä–∞—Ñ–∏–∫ –æ—Ç–ø—É—Å–∫–æ–≤!A1:F1000',
            apiKey: 'AIzaSyAauxIMg0cRKY30peWUY1H4Zip-Y2dFmd4',
            clientId: '18175449068-esm1ijhtr23gcdhvjog77bkq227ehab2.apps.googleusercontent.com'
        };

        let gapiInitialized = false;
        let tokenClient = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google API
        function initializeGoogleAPI() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google API...');
            
            gapi.load('client', () => {
                gapi.client.init({
                    apiKey: GOOGLE_SHEETS_CONFIG.apiKey,
                    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
                }).then(() => {
                    console.log('Google API –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    gapiInitialized = true;
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Identity Services
                    tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_SHEETS_CONFIG.clientId,
                        scope: 'https://www.googleapis.com/auth/spreadsheets',
                        callback: (response) => {
                            console.log('GIS token callback:', response);
                            if (response.access_token) {
                                gapi.client.setToken(response);
                                updateUIAuthState(true);
                                loadDataFromSheets();
                            }
                        }
                    });
                    // –ü—ã—Ç–∞–µ–º—Å—è —Ç–∏—Ö–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                    try {
                        tokenClient.requestAccessToken({ prompt: '' });
                    } catch (e) {
                        console.warn('Silent token request failed (first-time consent needed).', e);
                    }
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Google API:', error);
                    updateSyncStatus('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Google API', 'error');
                });
            });
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å Google
        function authenticateWithGoogle() {
            if (!gapiInitialized) {
                alert('Google API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                return;
            }
            
            console.log('–ó–∞–ø—Ä–æ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            tokenClient.requestAccessToken();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets
        function loadDataFromSheets() {
            if (!gapiInitialized || !gapi.client.getToken()) {
                console.log('Google API –Ω–µ –≥–æ—Ç–æ–≤ –∏–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞');
                updateSyncStatus('‚ùå Google API –Ω–µ –≥–æ—Ç–æ–≤', 'error');
                return;
            }

            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets...');
            updateSyncStatus('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: GOOGLE_SHEETS_CONFIG.spreadsheetId,
                range: GOOGLE_SHEETS_CONFIG.range
            }).then(response => {
                console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ Sheets:', response.result);
                
                const values = response.result.values;
                if (values && values.length > 1) {
                    absences = [];
                    for (let i = 1; i < values.length; i++) {
                        const row = values[i];
                        if (row.length >= 5) {
                            absences.push({
                                id: parseInt(row[0]) || Date.now() + i,
                                employee: row[1],
                                startDate: row[3], // –î–∞—Ç–∞_–Ω–∞—á–∞–ª–∞ –≤ –∫–æ–ª–æ–Ω–∫–µ D
                                endDate: row[4],   // –î–∞—Ç–∞_–æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ –∫–æ–ª–æ–Ω–∫–µ E
                                type: row[2],      // –¢–∏–ø –≤ –∫–æ–ª–æ–Ω–∫–µ C
                                comment: row[5] || ''
                            });
                        }
                    }
                    
                    console.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–π:', absences.length);
                    
                    updateEmployeeSelects();
                    updateEmployeesContainer();
                    updateTimelineHeader();
                    updateTimelines();
                    renderAbsences();
                    updateStats();
                    updateUpcomingAbsences();
                    updateSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Google Sheets', 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è —Ä–µ–∂–∏–º–∞ "–ü–æ –¥–Ω—è–º"
                    if (currentView === 'days') {
                        const monthNav = document.getElementById('month-navigation');
                        if (monthNav) {
                            monthNav.style.display = 'block';
                            updateMonthNavigation();
                        }
                    }
                } else {
                    console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets');
                    updateSyncStatus('üìÑ –¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞', 'info');
                }
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                updateSyncStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets
        function saveDataToSheets() {
            if (!gapiInitialized || !gapi.client.getToken()) {
                console.log('Google API –Ω–µ –≥–æ—Ç–æ–≤ –∏–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞');
                return;
            }

            console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...');
            
            const values = [
                ['ID', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫', '–¢–∏–ø', '–î–∞—Ç–∞_–Ω–∞—á–∞–ª–∞', '–î–∞—Ç–∞_–æ–∫–æ–Ω—á–∞–Ω–∏—è', '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π']
            ];
            
            absences.forEach(absence => {
                values.push([
                    absence.id,
                    absence.employee,
                    absence.type,
                    absence.startDate,
                    absence.endDate,
                    absence.comment || ''
                ]);
            });

            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: GOOGLE_SHEETS_CONFIG.spreadsheetId,
                range: GOOGLE_SHEETS_CONFIG.range,
                valueInputOption: 'RAW',
                resource: { values: values }
            }).then(response => {
                console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Google Sheets');
                updateSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Google Sheets', 'success');
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                updateSyncStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
            });
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets
        function syncWithSheets() {
            if (!gapiInitialized || !gapi.client.getToken()) {
                authenticateWithGoogle();
                return;
            }
            
            saveDataToSheets();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function updateSyncStatus(message, type) {
            const statusElement = document.getElementById('sync-status');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.style.background = type === 'success' ? '#d4edda' : 
                                               type === 'error' ? '#f8d7da' : '#fff3cd';
                statusElement.style.borderColor = type === 'success' ? '#c3e6cb' : 
                                                  type === 'error' ? '#f5c6cb' : '#ffeaa7';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth < 1) currentMonth = 12;
            if (currentMonth > 12) currentMonth = 1;
            
            updateMonthNavigation();
            updateTimelineHeader();
            updateTimelines();
            renderAbsences();
        }

        function updateMonthNavigation() {
            const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                               '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            const monthDisplay = document.getElementById('current-month-display');
            if (monthDisplay) {
                monthDisplay.textContent = `${monthNames[currentMonth - 1]} 2025`;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function updateUIAuthState(isAuthenticated) {
            const authButton = document.querySelector('button[onclick="authenticateWithGoogle()"]');
            if (authButton) {
                if (isAuthenticated) {
                    authButton.textContent = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                    authButton.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                } else {
                    authButton.textContent = 'üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google';
                    authButton.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Google API
            setTimeout(() => {
                initializeGoogleAPI();
            }, 1000);
            
            if (!loadData()) {
                addDemoData();
            }
            updateEmployeeSelects();
            updateEmployeesContainer();
            updateTimelineHeader();
            updateTimelines();
            renderAbsences();
            updateStats();
            updateUpcomingAbsences();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è —Ä–µ–∂–∏–º–∞ "–ü–æ –¥–Ω—è–º"
            if (currentView === 'days') {
                const monthNav = document.getElementById('month-navigation');
                if (monthNav) {
                    monthNav.style.display = 'block';
                    updateMonthNavigation();
                }
            }
        });
    </script>
</body>
</html>
